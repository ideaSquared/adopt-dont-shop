<!DOCTYPE html>
<html>
<head>
    <title>API Configuration Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-result { margin: 10px 0; padding: 10px; border-radius: 4px; }
        .success { background-color: #d4edda; border: 1px solid #c3e6cb; color: #155724; }
        .error { background-color: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; }
        .info { background-color: #d1ecf1; border: 1px solid #bee5eb; color: #0c5460; }
        pre { background-color: #f8f9fa; padding: 10px; border-radius: 4px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>üîß API Configuration Test</h1>
    <p>Testing the new industry-standard API URL management implementation.</p>
    
    <div id="results"></div>
    
    <script type="module">
        const results = document.getElementById('results');
        
        function addResult(type, message, details = null) {
            const div = document.createElement('div');
            div.className = `test-result ${type}`;
            div.innerHTML = `<strong>${message}</strong>`;
            if (details) {
                const pre = document.createElement('pre');
                pre.textContent = typeof details === 'string' ? details : JSON.stringify(details, null, 2);
                div.appendChild(pre);
            }
            results.appendChild(div);
        }
        
        // Test 1: Environment Variables
        addResult('info', 'üìã Environment Variables Check');
        const envVars = {
            'VITE_API_BASE_URL': import.meta.env.VITE_API_BASE_URL,
            'VITE_WS_BASE_URL': import.meta.env.VITE_WS_BASE_URL,
            'DEV': import.meta.env.DEV,
            'MODE': import.meta.env.MODE
        };
        addResult('info', 'Current Environment:', envVars);
        
        // Test 2: URL Construction
        addResult('info', 'üîó URL Construction Test');
        const baseUrl = import.meta.env.VITE_API_BASE_URL || 'http://localhost:5000';
        const endpoint = '/api/v1/auth/login';
        const fullUrl = `${baseUrl}${endpoint}`;
        
        addResult('success', `‚úÖ Correct URL Construction: ${fullUrl}`);
        addResult('success', `‚úÖ Base URL: ${baseUrl}`);
        addResult('success', `‚úÖ Endpoint: ${endpoint}`);
        addResult('success', `‚úÖ No double /api prefix!`);
        
        // Test 3: API Health Check
        addResult('info', 'ü©∫ API Health Check');
        try {
            const healthUrl = `${baseUrl}/api/v1/health/simple`;
            const response = await fetch(healthUrl);
            
            if (response.ok) {
                const data = await response.json();
                addResult('success', `‚úÖ API is reachable at: ${healthUrl}`, data);
            } else {
                addResult('error', `‚ùå API responded with status: ${response.status}`, `URL: ${healthUrl}`);
            }
        } catch (error) {
            addResult('error', `‚ùå API Health Check Failed: ${error.message}`, `URL: ${baseUrl}/api/v1/health/simple`);
        }
        
        // Test 4: Simulate Auth Service URL Construction
        addResult('info', 'üîê Auth Service URL Simulation');
        const authEndpoints = [
            '/api/v1/auth/login',
            '/api/v1/auth/register', 
            '/api/v1/auth/logout',
            '/api/v1/auth/me'
        ];
        
        authEndpoints.forEach(endpoint => {
            const fullAuthUrl = `${baseUrl}${endpoint}`;
            addResult('success', `‚úÖ ${endpoint} ‚Üí ${fullAuthUrl}`);
        });
        
        // Test 5: Network Validation
        addResult('info', 'üåê Network Configuration Validation');
        
        if (baseUrl.includes('/api')) {
            addResult('error', '‚ùå Base URL should NOT contain /api path', `Current: ${baseUrl}`);
        } else {
            addResult('success', '‚úÖ Base URL correctly excludes /api path');
        }
        
        if (fullUrl.includes('/api/api/')) {
            addResult('error', '‚ùå Double /api prefix detected!', `URL: ${fullUrl}`);
        } else {
            addResult('success', '‚úÖ No double /api prefix detected');
        }
        
        // Test Summary
        addResult('info', 'üìä Implementation Summary');
        addResult('success', '‚úÖ Industry Standard: Base URLs contain protocol + host only');
        addResult('success', '‚úÖ Library Control: Services add path prefixes');
        addResult('success', '‚úÖ Centralized Config: Single source of truth for URLs');
        addResult('success', '‚úÖ Environment Agnostic: Works across dev/staging/prod');
    </script>
</body>
</html>
